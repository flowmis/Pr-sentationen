<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Volleyball Turnier Losgenerator</title>
    <style>
        /* Bestehende Styles bleiben unverändert */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1, h2, h3, h4 {
            margin-top: 40px;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 20px;
            background-color: #fff;
        }
        th, td {
            border: 1px solid #aaa;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .player-list, .team-list, .matches-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #aaa;
            padding: 10px;
            margin-top: 10px;
            background-color: #fff;
        }
        .player-item, .team-item, .match-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }
        .add-player-form input, .add-player-form select, .add-player-form button {
            margin-right: 10px;
            padding: 5px;
            font-size: 14px;
        }
        .section {
            margin-bottom: 40px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .button {
            padding: 8px 16px;
            background-color: #28a745;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
            margin-left: 5px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #218838;
        }
        .message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        /* Button Styling für Punkteanpassung */
        .adjust-button {
            padding: 4px 8px;
            background-color: #007bff;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 12px;
            border-radius: 4px;
            margin-left: 5px;
            transition: background-color 0.3s;
        }
        .adjust-button:hover {
            background-color: #0069d9;
        }
        /* Disable Button Styling */
        .button:disabled, .adjust-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        /* Feedback Modal */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 999; 
            padding-top: 100px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: black;
        }
        /* Export Button */
        .export-button {
            background-color: #17a2b8;
        }
        .export-button:hover {
            background-color: #138496;
        }
    </style>
</head>
<body>

    <h1>Volleyball Turnier Losgenerator</h1>

    <!-- Erwachsene Spieler Verwaltung -->
    <div class="section">
        <h2>Erwachsene Spieler</h2>
        <div id="adultList" class="player-list"></div>
        <h3>Erwachsene Spieler Hinzufügen</h3>
        <form id="addAdultForm" class="add-player-form">
            <input type="text" id="adultName" placeholder="Name" required>
            <select id="adultPosition" required>
                <option value="" disabled selected>Position</option>
                <option value="MB">MB</option>
                <option value="AA">AA</option>
                <option value="Z">Z</option>
            </select>
            <select id="adultLeistung" required>
                <option value="" disabled selected>Leistung</option>
                <option value="1">1 - Sehr gut</option>
                <option value="2">2 - Gut</option>
                <option value="3">3 - Weniger gut</option>
            </select>
            <select id="adultGeschlecht" required>
                <option value="" disabled selected>Geschlecht</option>
                <option value="M">Männlich</option>
                <option value="F">Weiblich</option>
            </select>
            <button type="submit" class="button">Hinzufügen</button>
        </form>
        <div id="adultMessage" class="message"></div>
    </div>

    <!-- Jugendspieler Verwaltung -->
    <div class="section">
        <h2>Jugendspieler</h2>
        <div id="youthList" class="player-list"></div>
        <h3>Jugendspieler Hinzufügen</h3>
        <form id="addYouthForm" class="add-player-form">
            <input type="text" id="youthName" placeholder="Name" required>
            <select id="youthLeistung" required>
                <option value="" disabled selected>Leistung</option>
                <option value="1">1 - Sehr gut</option>
                <option value="2">2 - Gut</option>
                <option value="3">3 - Weniger gut</option>
            </select>
            <select id="youthGeschlecht" required>
                <option value="" disabled selected>Geschlecht</option>
                <option value="M">Männlich</option>
                <option value="F">Weiblich</option>
            </select>
            <button type="submit" class="button">Hinzufügen</button>
        </form>
        <div id="youthMessage" class="message"></div>
    </div>

    <!-- Teams Losen -->
    <div class="section">
        <h2>Teams Losen</h2>
        
        <!-- Eingabefelder für Teamgrößen und Anzahl der Teams -->
        <div style="margin-bottom: 20px;">
            <label for="numberOfTeams">Anzahl der Teams:</label>
            <input type="number" id="numberOfTeams" value="6" min="1" style="width: 50px; margin-left: 10px;">
        </div>
        <div style="margin-bottom: 20px;">
            <label for="adultTeamSize">Erwachsene pro Erwachsenen-Team:</label>
            <input type="number" id="adultTeamSize" value="6" min="1" style="width: 50px; margin-left: 10px;">
        </div>
        <div style="margin-bottom: 20px;">
            <label for="adultPerMixedTeam">Erwachsene pro Team Jugend:</label>
            <input type="number" id="adultPerMixedTeam" value="1" min="1" style="width: 50px; margin-left: 10px;">
        </div>
        <div style="margin-bottom: 20px;">
            <label for="youthPerMixedTeam">Jugendspieler pro Team Jugend:</label>
            <input type="number" id="youthPerMixedTeam" value="2" min="1" style="width: 50px; margin-left: 10px;">
        </div>
        
        <button id="drawButton" class="button">Jetzt Losen</button>
        <button id="exportButton" class="button export-button">Ergebnisse Exportieren</button>

        <!-- Abschnitt für nicht zugeteilte Spieler -->
        <div id="unassignedPlayersSection" class="section" style="display:none;">
            <h3>Nicht zugeteilte Spieler</h3>
            <div id="unassignedAdults" class="player-list">
                <h4>Erwachsene</h4>
                <!-- Nicht zugeteilte Erwachsene Spieler werden hier angezeigt -->
            </div>
            <div id="unassignedYouth" class="player-list">
                <h4>Jugendspieler</h4>
                <!-- Nicht zugeteilte Jugendspieler werden hier angezeigt -->
            </div>
        </div>
    </div>

    <!-- Ergebnisse -->
    <div class="section" id="resultsSection" style="display:none;">
        <h2>Ergebnisse</h2>

        <h3>Erwachsenenteams</h3>
        <div id="adultTeamsList" class="team-list"></div>

        <h3>Gemischte Teams</h3>
        <div id="mixedTeamsList" class="team-list"></div>

        <h3>Paarungen</h3>
        <div id="matchesList" class="team-list">
            <h4>Erwachsenen Matches</h4>
            <div id="adultMatches"></div>
            <h4>Gemischte Matches</h4>
            <div id="mixedMatches"></div>
        </div>

        <h3>Spielergebnisse und Punkte</h3>
        <table id="pointsTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <!-- <th>Geschlecht</th> <!-- Entfernt -->
                    <th>Spiele</th>
                    <th>Punkte</th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Teams erfolgreich losgezogen!</h2>
            <div id="feedbackContent"></div>
        </div>
    </div>

    <script>
        // Datenstrukturen zum Speichern der Spieler
        let youthPlayers = [
            { Name: "Frieda M.", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Julia E.", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Elena C.", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Noemi R.", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Mirjam K.", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Jakob K.", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Bennett G.", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Annelie M.", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Alex Z.", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Laurenz J.", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "David S.", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Elya M.", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 }
        ];

        let adultPlayers = [
            { Name: "Alex K.", Position: "MB", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Ali K.", Position: "Z", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Anna R.", Position: "AA", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Ben B.", Position: "MB", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Caro S.", Position: "MB", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Daniel E.", Position: "AA", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Daria A.", Position: "AA", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Elias K.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Emilia H.", Position: "AA", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Emily K.", Position: "AA", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Fabian D.", Position: "MB", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Felina S.", Position: "AA", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Felix K.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Felix L.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Florian B.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Hannes G.", Position: "MB", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Helene M.", Position: "AA", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Ida B.", Position: "MB", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Jan K.", Position: "MB", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Jannis E.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Jannis H.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Jannis W.", Position: "MB", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Janos S.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Joel D.", Position: "AA", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Johanna S.", Position: "MB", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Jonas G.", Position: "AA", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Jonas L.", Position: "Z", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Julian S.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Katharina B.", Position: "AA", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Katja H.", Position: "Z", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Lara K.", Position: "MB", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Leah B.", Position: "AA", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Leah R.", Position: "AA", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Lenard S.", Position: "Z", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Leni J.", Position: "AA", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Leo B.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Leonhard S.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Lilli B.", Position: "Z", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Lina M.", Position: "AA", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Linus W.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Lucie N.", Position: "AA", Leistung: "3", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Markus H.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Martin U.", Position: "Z", Leistung: "2", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Max D.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Michi H.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Mieke K.", Position: "AA", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Nelly A.", Position: "MB", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Nicklas K.", Position: "MB", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Nikita S.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Patrick S.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Paul L.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Philipp K.", Position: "Z", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Pius M.", Position: "Z", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Robin W.", Position: "Z", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Ronja B.", Position: "AA", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Rune D.", Position: "Z", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Sara T.", Position: "Z", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Sebastian M.", Position: "AA", Leistung: "3", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Steffi G.", Position: "Z", Leistung: "1", Geschlecht: "F", Spiele: 0, Punkte: 0 },
            { Name: "Tom W.", Position: "AA", Leistung: "1", Geschlecht: "M", Spiele: 0, Punkte: 0 },
            { Name: "Vica M.", Position: "Z", Leistung: "2", Geschlecht: "F", Spiele: 0, Punkte: 0 }
        ];

        // DOM Elemente
        const adultListDiv = document.getElementById('adultList');
        const youthListDiv = document.getElementById('youthList');
        const addAdultForm = document.getElementById('addAdultForm');
        const addYouthForm = document.getElementById('addYouthForm');
        const drawButton = document.getElementById('drawButton');
        const exportButton = document.getElementById('exportButton');
        const resultsSection = document.getElementById('resultsSection');
        const adultTeamsListDiv = document.getElementById('adultTeamsList');
        const mixedTeamsListDiv = document.getElementById('mixedTeamsList');
        const matchesListDiv = document.getElementById('matchesList');
        const adultMatchesDiv = document.getElementById('adultMatches');
        const mixedMatchesDiv = document.getElementById('mixedMatches');
        const pointsTableBody = document.querySelector('#pointsTable tbody');
        const adultMessageDiv = document.getElementById('adultMessage');
        const youthMessageDiv = document.getElementById('youthMessage');

        // Eingabefelder für Teamgrößen und Anzahl der Teams
        const numberOfTeamsInput = document.getElementById('numberOfTeams');
        const adultTeamSizeInput = document.getElementById('adultTeamSize');
        const adultPerMixedTeamInput = document.getElementById('adultPerMixedTeam');
        const youthPerMixedTeamInput = document.getElementById('youthPerMixedTeam');

        // Arrays zur Speicherung der Teams
        let adultTeams = [];   // Erwachsene Teams
        let mixedTeams = [];   // Gemischte Teams

        // Funktion zum Laden von Daten aus localStorage
        function loadData() {
            const savedAdults = localStorage.getItem('adultPlayers');
            const savedYouth = localStorage.getItem('youthPlayers');
            const savedAdultTeams = localStorage.getItem('adultTeams');
            const savedMixedTeams = localStorage.getItem('mixedTeams');
            const savedPoints = localStorage.getItem('points');

            if (savedAdults) {
                adultPlayers = JSON.parse(savedAdults);
            }
            if (savedYouth) {
                youthPlayers = JSON.parse(savedYouth);
            }
            if (savedAdultTeams) {
                adultTeams = JSON.parse(savedAdultTeams);
            }
            if (savedMixedTeams) {
                mixedTeams = JSON.parse(savedMixedTeams);
            }
            if (savedPoints) {
                const pointsData = JSON.parse(savedPoints);
                adultPlayers.forEach((player, index) => {
                    if (pointsData.adultPlayers[index]) {
                        player.Spiele = pointsData.adultPlayers[index].Spiele;
                        player.Punkte = pointsData.adultPlayers[index].Punkte;
                    }
                });
                youthPlayers.forEach((player, index) => {
                    if (pointsData.youthPlayers[index]) {
                        player.Spiele = pointsData.youthPlayers[index].Spiele;
                        player.Punkte = pointsData.youthPlayers[index].Punkte;
                    }
                });
            }
        }

        // Funktion zum Speichern von Daten in localStorage
        function saveData() {
            localStorage.setItem('adultPlayers', JSON.stringify(adultPlayers));
            localStorage.setItem('youthPlayers', JSON.stringify(youthPlayers));
            localStorage.setItem('adultTeams', JSON.stringify(adultTeams));
            localStorage.setItem('mixedTeams', JSON.stringify(mixedTeams));
            const pointsData = {
                adultPlayers: adultPlayers.map(p => ({ Spiele: p.Spiele, Punkte: p.Punkte })),
                youthPlayers: youthPlayers.map(p => ({ Spiele: p.Spiele, Punkte: p.Punkte }))
            };
            localStorage.setItem('points', JSON.stringify(pointsData));
        }

        // Funktionen zum Rendern der Spielerlisten
        function renderAdultList() {
            adultListDiv.innerHTML = '';
            adultPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `
                    <span>${player.Name}</span>
                    <button class="button" onclick="deleteAdultPlayer(${index})">Löschen</button>
                `;
                adultListDiv.appendChild(div);
            });
        }

        function renderYouthList() {
            youthListDiv.innerHTML = '';
            youthPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `
                    <span>${player.Name}</span>
                    <button class="button" onclick="deleteYouthPlayer(${index})">Löschen</button>
                `;
                youthListDiv.appendChild(div);
            });
        }

        // Initiales Rendern der Listen beim Laden der Seite
        window.onload = function() {
            loadData();
            renderAdultList();
            renderYouthList();
            if (adultTeams.length > 0 || mixedTeams.length > 0) {
                displayResults(adultTeams, mixedTeams);
            }
            updatePointsTable();
        }

        // Funktionen zum Löschen von Spielern
        window.deleteAdultPlayer = function(index) {
            if(confirm(`Möchten Sie ${adultPlayers[index].Name} wirklich löschen?`)){
                adultPlayers.splice(index, 1);
                renderAdultList();
                saveData();
                updatePointsTable();
            }
        }

        window.deleteYouthPlayer = function(index) {
            if(confirm(`Möchten Sie ${youthPlayers[index].Name} wirklich löschen?`)){
                youthPlayers.splice(index, 1);
                renderYouthList();
                saveData();
                updatePointsTable();
            }
        }

        // Event Listener für Erwachsene Spieler Hinzufügen
        addAdultForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('adultName').value.trim();
            const position = document.getElementById('adultPosition').value;
            const leistung = document.getElementById('adultLeistung').value;
            const geschlecht = document.getElementById('adultGeschlecht').value;

            // Überprüfung auf Duplikate
            if(adultPlayers.some(p => p.Name.toLowerCase() === name.toLowerCase())){
                adultMessageDiv.textContent = "Ein Spieler mit diesem Namen existiert bereits.";
                adultMessageDiv.className = 'message error';
                return;
            }

            if(name && position && leistung && geschlecht){
                adultPlayers.push({ Name: name, Position: position, Leistung: leistung, Geschlecht: geschlecht, Spiele: 0, Punkte: 0 });
                renderAdultList();
                addAdultForm.reset();
                adultMessageDiv.textContent = `${name} erfolgreich hinzugefügt.`;
                adultMessageDiv.className = 'message success';
                console.log("Erwachsene Spieler nach Hinzufügen:", adultPlayers);
                saveData();
                updatePointsTable();
            } else {
                adultMessageDiv.textContent = "Bitte füllen Sie alle Felder im Erwachsenen-Formular aus.";
                adultMessageDiv.className = 'message error';
            }
        });

        // Event Listener für Jugendspieler Hinzufügen
        addYouthForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('youthName').value.trim();
            const leistung = document.getElementById('youthLeistung').value;
            const geschlecht = document.getElementById('youthGeschlecht').value;

            // Überprüfung auf Duplikate
            if(youthPlayers.some(p => p.Name.toLowerCase() === name.toLowerCase())){
                youthMessageDiv.textContent = "Ein Spieler mit diesem Namen existiert bereits.";
                youthMessageDiv.className = 'message error';
                return;
            }

            if(name && leistung && geschlecht){
                youthPlayers.push({ Name: name, Leistung: leistung, Geschlecht: geschlecht, Spiele: 0, Punkte: 0 });
                renderYouthList();
                addYouthForm.reset();
                youthMessageDiv.textContent = `${name} erfolgreich hinzugefügt.`;
                youthMessageDiv.className = 'message success';
                console.log("Jugendspieler nach Hinzufügen:", youthPlayers);
                saveData();
                updatePointsTable();
            } else {
                youthMessageDiv.textContent = "Bitte füllen Sie alle Felder im Jugendspieler-Formular aus.";
                youthMessageDiv.className = 'message error';
            }
        });

        // Funktion zum Zufälligen Mischen eines Arrays
        function shuffle(array) {
            for (let i = array.length -1; i >0; i--){
                const j = Math.floor(Math.random() * (i +1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Funktion zum Aufteilen der Spieler nach Geschlecht und Leistung
        function splitByGenderAndLeistung(players) {
            const males = players.filter(p => p.Geschlecht === 'M');
            const females = players.filter(p => p.Geschlecht === 'F');
            return { males, females };
        }

        // Funktion zum Berechnen des Durchschnitts der Spiele
        function calculateAverageSpiele(players) {
            if(players.length === 0) return 0;
            const totalSpiele = players.reduce((sum, player) => sum + player.Spiele, 0);
            return totalSpiele / players.length;
        }

        // Funktion zum Bestimmen passiver Spieler
        function getPassivePlayers(players, averageSpiele) {
            return players.filter(p => p.Spiele < averageSpiele);
        }

        // Überarbeitete Funktion zum gleichmäßigen Zuweisen von Spielern
        function assignBalancedPlayers(shuffledGroup1, shuffledGroup2, playersPerTeam, numberOfTeams) {
            const assignedPlayers = [];
            for(let i = 0; i < numberOfTeams; i++){
                for(let p = 0; p < playersPerTeam; p++){
                    if(p %2 ===0 && shuffledGroup1.length >0){
                        assignedPlayers.push(shuffledGroup1.shift());
                    }
                    else if(shuffledGroup2.length >0){
                        assignedPlayers.push(shuffledGroup2.shift());
                    }
                }
            }
            return assignedPlayers;
        }

        // Funktion zum Losen der Teams
        drawButton.addEventListener('click', function() {
            // Lesen der Eingaben
            const numberOfTeams = parseInt(numberOfTeamsInput.value);
            const adultTeamSize = parseInt(adultTeamSizeInput.value);
            const adultPerMixedTeam = parseInt(adultPerMixedTeamInput.value);
            const youthPerMixedTeam = parseInt(youthPerMixedTeamInput.value);

            // Validieren der Eingaben
            if(isNaN(numberOfTeams) || numberOfTeams < 1){
                alert("Bitte geben Sie eine gültige Anzahl der Teams ein.");
                return;
            }
            if(isNaN(adultTeamSize) || adultTeamSize < 1){
                alert("Bitte geben Sie eine gültige Anzahl für Erwachsene pro Erwachsenen-Team ein.");
                return;
            }
            if(isNaN(adultPerMixedTeam) || adultPerMixedTeam < 1){
                alert("Bitte geben Sie eine gültige Anzahl für Erwachsene pro gemischtem Team ein.");
                return;
            }
            if(isNaN(youthPerMixedTeam) || youthPerMixedTeam < 1){
                alert("Bitte geben Sie eine gültige Anzahl für Jugendspieler pro gemischtem Team ein.");
                return;
            }

            // Berechnung der erforderlichen Spieler
            const requiredAdults = (numberOfTeams * adultTeamSize) + (numberOfTeams * adultPerMixedTeam);
            const requiredYouth = numberOfTeams * youthPerMixedTeam;

            // Überprüfen der Mindestanzahl von Spielern
            if(adultPlayers.length < requiredAdults){
                alert(`Es müssen mindestens ${requiredAdults} Erwachsene Teilnehmer vorhanden sein (für ${numberOfTeams} Erwachsene Teams mit je ${adultTeamSize} Spielern und ${numberOfTeams} Erwachsene für gemischte Teams mit je ${adultPerMixedTeam} Erwachsenen).`);
                return;
            }
            if(youthPlayers.length < requiredYouth){
                alert(`Es müssen mindestens ${requiredYouth} Jugendspieler vorhanden sein (für ${numberOfTeams} gemischte Teams mit je ${youthPerMixedTeam} Jugendspielern).`);
                return;
            }

            // Durchschnittliche Spiele berechnen
            const averageAdultSpiele = calculateAverageSpiele(adultPlayers);
            const averageYouthSpiele = calculateAverageSpiele(youthPlayers);

            // Passive Spieler ermitteln
            const passiveAdults = getPassivePlayers(adultPlayers, averageAdultSpiele);
            const passiveYouth = getPassivePlayers(youthPlayers, averageYouthSpiele);

            // Spieler priorisieren: Passive zuerst
            const prioritizedAdultPlayers = [...passiveAdults, ...adultPlayers.filter(p => p.Spiele >= averageAdultSpiele)];
            const prioritizedYouthPlayers = [...passiveYouth, ...youthPlayers.filter(p => p.Spiele >= averageYouthSpiele)];

            // Trennen der Erwachsenen und Jugendspieler nach Geschlecht und Leistung
            const { males: adultMales, females: adultFemales } = splitByGenderAndLeistung(prioritizedAdultPlayers);
            const { males: youthMales, females: youthFemales } = splitByGenderAndLeistung(prioritizedYouthPlayers);

            // Shuffle die Spieler innerhalb jeder Geschlechtergruppe
            const shuffledAdultMales = shuffle([...adultMales]);
            const shuffledAdultFemales = shuffle([...adultFemales]);
            const shuffledYouthMales = shuffle([...youthMales]);
            const shuffledYouthFemales = shuffle([...youthFemales]);

            // Erwachsene für Erwachsenen-Teams zuweisen
            const adultsForAdultTeams = assignBalancedPlayers(shuffledAdultMales, shuffledAdultFemales, adultTeamSize, numberOfTeams);

            // Erwachsene für gemischte Teams zuweisen
            const adultsForMixedTeams = assignBalancedPlayers(shuffledAdultMales, shuffledAdultFemales, adultPerMixedTeam, numberOfTeams);

            // Jugendspieler für gemischte Teams zuweisen
            const youthsForMixedTeams = assignBalancedPlayers(shuffledYouthMales, shuffledYouthFemales, youthPerMixedTeam, numberOfTeams);

            // Erstellen der Erwachsenen Teams
            adultTeams = [];
            for(let i = 0; i < numberOfTeams; i++){
                const team = adultsForAdultTeams.slice(i * adultTeamSize, (i +1) * adultTeamSize);
                adultTeams.push(team);
            }

            // Erstellen der gemischten Teams
            mixedTeams = [];
            for(let i = 0; i < numberOfTeams; i++){
                const team = [];
                // Erwachsene für gemischtes Team
                team.push(...adultsForMixedTeams.slice(i * adultPerMixedTeam, (i +1) * adultPerMixedTeam));
                // Jugendspieler für gemischtes Team
                team.push(...youthsForMixedTeams.slice(i * youthPerMixedTeam, (i +1) * youthPerMixedTeam));
                mixedTeams.push(team);
            }

            // Speichern der Teams und aktualisierten Spiele in localStorage
            saveData();

            // Anzeigen der Ergebnisse
            displayResults(adultTeams, mixedTeams);
            console.log("Teams Erwachsene:", adultTeams);
            console.log("Teams Jugend:", mixedTeams);

            // Ermitteln der nicht zugeteilten Erwachsenen Spieler
            const assignedAdultNames = adultTeams.flat().map(p => p.Name).concat(mixedTeams.flat().map(p => p.Name));
            const unassignedAdults = adultPlayers.filter(p => !assignedAdultNames.includes(p.Name));

            // Ermitteln der nicht zugeteilten Jugendspieler
            const assignedYouthNames = mixedTeams.flat().map(p => p.Name);
            const unassignedYouth = youthPlayers.filter(p => !assignedYouthNames.includes(p.Name));

            // Referenzen zu den HTML-Elementen für unzugewiesene Spieler
            const unassignedAdultsDiv = document.getElementById('unassignedAdults');
            const unassignedYouthDiv = document.getElementById('unassignedYouth');
            const unassignedPlayersSection = document.getElementById('unassignedPlayersSection');

            // Rendern der nicht zugeteilten Erwachsenen Spieler
            unassignedAdultsDiv.innerHTML = '';
            if(unassignedAdults.length > 0){
                unassignedAdults.forEach(player => {
                    const div = document.createElement('div');
                    div.className = 'player-item';
                    div.textContent = `${player.Name} (${player.Geschlecht}) - ${player.Position}, Leistung: ${player.Leistung}`;
                    unassignedAdultsDiv.appendChild(div);
                });
            } else{
                unassignedAdultsDiv.innerHTML = '<p>Keine nicht zugeteilten Erwachsenen Spieler.</p>';
            }

            // Rendern der nicht zugeteilten Jugendspieler
            unassignedYouthDiv.innerHTML = '';
            if(unassignedYouth.length > 0){
                unassignedYouth.forEach(player => {
                    const div = document.createElement('div');
                    div.className = 'player-item';
                    div.textContent = `${player.Name} (${player.Geschlecht}) - Leistung: ${player.Leistung}`;
                    unassignedYouthDiv.appendChild(div);
                });
            } else{
                unassignedYouthDiv.innerHTML = '<p>Keine nicht zugeteilten Jugendspieler.</p>';
            }

            // Anzeigen des Abschnitts, wenn es unzugewiesene Spieler gibt
            if(unassignedAdults.length > 0 || unassignedYouth.length > 0){
                unassignedPlayersSection.style.display = 'block';
            } else{
                unassignedPlayersSection.style.display = 'none';
            }

            // Feedback Modal anzeigen
            showFeedbackModal(adultTeams, mixedTeams);
        });

        // Funktion zum Anzeigen der Ergebnisse
        function displayResults(adultTeams, mixedTeams){
            // Ergebnisse Sektion anzeigen
            resultsSection.style.display = 'block';

            // Erwachsene Teams anzeigen
            adultTeamsListDiv.innerHTML = '';
            adultTeams.forEach((team, index) => {
                const div = document.createElement('div');
                div.className = 'team-item';
                // Nur den Namen anzeigen
                const names = team.map(p => `${p.Name}`).join(', ');
                div.innerHTML = `<strong>Erwachsenenteam ${index +1}:</strong> ${names}`;
                adultTeamsListDiv.appendChild(div);
            });

            // Gemischte Teams anzeigen
            mixedTeamsListDiv.innerHTML = '';
            mixedTeams.forEach((team, index) => {
                const div = document.createElement('div');
                div.className = 'team-item';
                // Nur den Namen anzeigen
                const names = team.map(p => `${p.Name}`).join(', ');
                div.innerHTML = `<strong>Team Jugend ${index +1}:</strong> ${names}`;
                mixedTeamsListDiv.appendChild(div);
            });

            // Paarungen erstellen
            createMatches(adultTeams, mixedTeams);
        }

        // Funktion zum Erstellen der Paarungen mit Gewinner-Buttons
        function createMatches(adultTeams, mixedTeams){
            // Erwachsenen Matches
            adultMatchesDiv.innerHTML = '';
            for(let i=0; i<adultTeams.length; i+=2){
                if(i+1 < adultTeams.length){
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'match-item';
                    matchDiv.innerHTML = `
                        <strong>Feld ${Math.floor(i/2)+1}:</strong> Erwachsenenteam ${i+1} gegen Erwachsenenteam ${i+2}
                        <button class="button" data-match-type="adult" data-winning-team="${i}">Gewinner: Team ${i+1}</button>
                        <button class="button" data-match-type="adult" data-winning-team="${i+1}">Gewinner: Team ${i+2}</button>
                    `;
                    adultMatchesDiv.appendChild(matchDiv);
                }
            }

            // Gemischte Matches
            mixedMatchesDiv.innerHTML = '';
            for(let i=0; i<mixedTeams.length; i+=2){
                if(i+1 < mixedTeams.length){
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'match-item';
                    matchDiv.innerHTML = `
                        <strong>Gemischtes Feld ${Math.floor(i/2)+1}:</strong> Gemischtes Team ${i+1} gegen Gemischtes Team ${i+2}
                        <button class="button" data-match-type="mixed" data-winning-team="${i}">Gewinner: Team ${i+1}</button>
                        <button class="button" data-match-type="mixed" data-winning-team="${i+1}">Gewinner: Team ${i+2}</button>
                    `;
                    mixedMatchesDiv.appendChild(matchDiv);
                }
            }

            // Event Listener für alle Buttons hinzufügen
            const resultButtons = document.querySelectorAll('.match-item .button');
            resultButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const matchType = this.getAttribute('data-match-type');
                    const winningTeamIndex = parseInt(this.getAttribute('data-winning-team'));
                    recordMatchResult(matchType, winningTeamIndex);
                    // Buttons für dieses Match deaktivieren nach der Auswahl
                    this.parentNode.querySelectorAll('.button').forEach(btn => btn.disabled = true);
                });
            });
        }

        // Funktion zur Verarbeitung des Match-Ergebnisses
        function recordMatchResult(matchType, winningTeamIndex) {
            let winningTeam = [];
            let losingTeam = [];

            if(matchType === 'adult'){
                // Gewinnerteam ermitteln
                winningTeam = adultTeams[winningTeamIndex];
                // Verliererteam ermitteln
                const opponentIndex = (winningTeamIndex % 2 === 0) ? winningTeamIndex + 1 : winningTeamIndex - 1;
                losingTeam = adultTeams[opponentIndex];
            } else if(matchType === 'mixed'){
                // Gewinnerteam ermitteln
                winningTeam = mixedTeams[winningTeamIndex];
                // Verliererteam ermitteln
                const opponentIndex = (winningTeamIndex % 2 === 0) ? winningTeamIndex + 1 : winningTeamIndex - 1;
                losingTeam = mixedTeams[opponentIndex];
            } else {
                alert("Unbekannter Match-Typ.");
                return;
            }

            // Punkte und Spiele zuweisen
            assignPoints(winningTeam, losingTeam);

            // Benachrichtigung anzeigen
            alert(`${formatTeamName(matchType, winningTeamIndex)} hat gewonnen.`);
        }

        // Funktion zur Formatierung der Team-Namen für die Anzeige
        function formatTeamName(matchType, teamIndex){
            if(matchType === 'adult'){
                return `Erwachsenenteam ${teamIndex +1}`;
            } else if(matchType === 'mixed'){
                return `Team Jugend ${teamIndex +1}`;
            }
            return '';
        }

        // Funktion zur Zuweisung von Punkten und Spielen
        function assignPoints(winningTeam, losingTeam){
            console.log("Assigning points to winning team:", winningTeam.map(p => p.Name));
            winningTeam.forEach(player => {
                const existingPlayer = findPlayerByName(player.Name);
                if(existingPlayer){
                    existingPlayer.Punkte +=1;
                    existingPlayer.Spiele +=1;
                    console.log(`${existingPlayer.Name} gewinnt und hat nun ${existingPlayer.Spiele} Spiele.`);
                } else {
                    console.error(`Gewinner Spieler "${player.Name}" nicht gefunden.`);
                }
            });

            console.log("Assigning games to losing team:", losingTeam.map(p => p.Name));
            losingTeam.forEach(player => {
                const existingPlayer = findPlayerByName(player.Name);
                if(existingPlayer){
                    existingPlayer.Spiele +=1;
                    console.log(`${existingPlayer.Name} verliert und hat nun ${existingPlayer.Spiele} Spiele.`);
                } else {
                    console.error(`Verlierer Spieler "${player.Name}" nicht gefunden.`);
                }
            });

            // Aktualisieren der Punkte Tabelle
            updatePointsTable();

            // Speichern der Daten
            saveData();
        }

        // Funktion zur Suche eines Spielers anhand des Namens
        function findPlayerByName(name){
            // Suche in Erwachsenen
            let player = adultPlayers.find(p => p.Name === name);
            if(player){
                return player;
            }
            // Suche in Jugendlichen
            player = youthPlayers.find(p => p.Name === name);
            return player;
        }

        // Funktion zur Aktualisierung der Punkte Tabelle
        function updatePointsTable() {
            pointsTableBody.innerHTML = '';

            // Erwachsene Spieler
            adultPlayers.forEach((player, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${player.Name}</td>
                    <!-- <td>${player.Geschlecht}</td> <!-- Entfernt -->
                    <td>${player.Spiele}</td>
                    <td>${player.Punkte}</td>
                    <td>
                        <button class="adjust-button" onclick="adjustPoints('adult', ${index}, 1)">+ Punkt</button>
                        <button class="adjust-button" onclick="adjustPoints('adult', ${index}, -1)">- Punkt</button>
                        <button class="adjust-button" onclick="adjustGames('adult', ${index}, 1)">+ Spiel</button>
                        <button class="adjust-button" onclick="adjustGames('adult', ${index}, -1)">- Spiel</button>
                    </td>
                `;
                pointsTableBody.appendChild(tr);
            });

            // Jugendspieler
            youthPlayers.forEach((player, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${player.Name}</td>
                    <!-- <td>${player.Geschlecht}</td> <!-- Entfernt -->
                    <td>${player.Spiele}</td>
                    <td>${player.Punkte}</td>
                    <td>
                        <button class="adjust-button" onclick="adjustPoints('youth', ${index}, 1)">+ Punkt</button>
                        <button class="adjust-button" onclick="adjustPoints('youth', ${index}, -1)">- Punkt</button>
                        <button class="adjust-button" onclick="adjustGames('youth', ${index}, 1)">+ Spiel</button>
                        <button class="adjust-button" onclick="adjustGames('youth', ${index}, -1)">- Spiel</button>
                    </td>
                `;
                pointsTableBody.appendChild(tr);
            });
        }

        // Funktion zur Anpassung der Punkte
        function adjustPoints(playerType, index, delta){
            if(playerType === 'adult'){
                if(index >= adultPlayers.length || index < 0){
                    alert("Ungültiger Spielerindex.");
                    return;
                }
                const player = adultPlayers[index];
                if(delta === -1 && player.Punkte <= 0){
                    alert("Punkte können nicht negativ sein.");
                    return;
                }
                player.Punkte += delta;
                console.log(`${player.Name} Punkte geändert um ${delta}. Neue Punkte: ${player.Punkte}`);
            } else if(playerType === 'youth'){
                if(index >= youthPlayers.length || index < 0){
                    alert("Ungültiger Spielerindex.");
                    return;
                }
                const player = youthPlayers[index];
                if(delta === -1 && player.Punkte <= 0){
                    alert("Punkte können nicht negativ sein.");
                    return;
                }
                player.Punkte += delta;
                console.log(`${player.Name} Punkte geändert um ${delta}. Neue Punkte: ${player.Punkte}`);
            }
            updatePointsTable();
            saveData();
        }

        // Funktion zur Anpassung der Spiele
        function adjustGames(playerType, index, delta){
            if(playerType === 'adult'){
                if(index >= adultPlayers.length || index < 0){
                    alert("Ungültiger Spielerindex.");
                    return;
                }
                const player = adultPlayers[index];
                if(delta === -1 && player.Spiele <= 0){
                    alert("Spiele können nicht negativ sein.");
                    return;
                }
                player.Spiele += delta;
                console.log(`${player.Name} Spiele geändert um ${delta}. Neue Spiele: ${player.Spiele}`);
            } else if(playerType === 'youth'){
                if(index >= youthPlayers.length || index < 0){
                    alert("Ungültiger Spielerindex.");
                    return;
                }
                const player = youthPlayers[index];
                if(delta === -1 && player.Spiele <= 0){
                    alert("Spiele können nicht negativ sein.");
                    return;
                }
                player.Spiele += delta;
                console.log(`${player.Name} Spiele geändert um ${delta}. Neue Spiele: ${player.Spiele}`);
            }
            updatePointsTable();
            saveData();
        }

        // Funktion zum Anzeigen der Feedback Modal
        function showFeedbackModal(adultTeams, mixedTeams){
            const modal = document.getElementById('feedbackModal');
            const span = document.getElementsByClassName('close')[0];
            const feedbackContent = document.getElementById('feedbackContent');

            // Inhalt der Modal mit Teams
            let contentHTML = `<h3>Erwachsenenteams:</h3>`;
            adultTeams.forEach((team, index) => {
                // Nur den Namen anzeigen
                const names = team.map(p => `${p.Name}`).join(', ');
                contentHTML += `<p><strong>Team ${index +1}:</strong> ${names}</p>`;
            });

            contentHTML += `<h3>Gemischte Teams:</h3>`;
            mixedTeams.forEach((team, index) => {
                // Nur den Namen anzeigen
                const names = team.map(p => `${p.Name}`).join(', ');
                contentHTML += `<p><strong>Team Jugend ${index +1}:</strong> ${names}</p>`;
            });

            feedbackContent.innerHTML = contentHTML;

            // Modal anzeigen
            modal.style.display = "block";

            // Schließen der Modal beim Klicken auf das 'x'
            span.onclick = function() {
                modal.style.display = "none";
            }

            // Schließen der Modal beim Klicken außerhalb der Modal
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }

        // Funktion zum Exportieren der Ergebnisse als CSV
        exportButton.addEventListener('click', function() {
            const csvContent = generateCSV();
            downloadCSV(csvContent, 'spielergebnisse.csv');
        });

        // Funktion zum Generieren des CSV-Inhalts
        function generateCSV() {
            let csv = 'Name,Spiele,Punkte\n'; // Geschlecht entfernt
            adultPlayers.forEach(player => {
                csv += `"${player.Name}",${player.Spiele},${player.Punkte}\n`;
            });
            youthPlayers.forEach(player => {
                csv += `"${player.Name}",${player.Spiele},${player.Punkte}\n`;
            });
            return csv;
        }

        // Funktion zum Herunterladen der CSV-Datei
        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            if (navigator.msSaveBlob) { // IE 10+
                navigator.msSaveBlob(blob, filename);
            } else {
                const link = document.createElement("a");
                if (link.download !== undefined) { // Feature detection
                    const url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }

    </script>

</body>
</html>
